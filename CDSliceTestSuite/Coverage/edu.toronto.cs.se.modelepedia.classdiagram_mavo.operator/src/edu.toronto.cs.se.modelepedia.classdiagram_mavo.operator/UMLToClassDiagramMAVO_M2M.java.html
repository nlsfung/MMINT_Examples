<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>UMLToClassDiagramMAVO_M2M.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">Eclipse Application (8-Jan-2018 6:43:10 PM)</a> &gt; <a href="../../index.html" class="el_group">edu.toronto.cs.se.modelepedia.classdiagram_mavo.operator</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.source.html" class="el_package">edu.toronto.cs.se.modelepedia.classdiagram_mavo.operator</a> &gt; <span class="el_source">UMLToClassDiagramMAVO_M2M.java</span></div><h1>UMLToClassDiagramMAVO_M2M.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Copyright (c) 2010, 2012 Obeo.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 * 
 * Contributors:
 *     Obeo - initial API and implementation
 *******************************************************************************/
package edu.toronto.cs.se.modelepedia.classdiagram_mavo.operator;

import java.io.IOException;
import java.io.InputStream;
import java.net.URL;
import java.util.HashMap;
import java.util.Map;
import java.util.Properties;
import java.util.Map.Entry;

import org.eclipse.core.runtime.FileLocator;
import org.eclipse.core.runtime.IProgressMonitor;
import org.eclipse.core.runtime.NullProgressMonitor;
import org.eclipse.core.runtime.Path;
import org.eclipse.core.runtime.Platform;
import org.eclipse.emf.ecore.EPackage;
import org.eclipse.emf.ecore.resource.Resource;
import org.eclipse.emf.ecore.xmi.impl.EcoreResourceFactoryImpl;
import org.eclipse.m2m.atl.common.ATLExecutionException;
import org.eclipse.m2m.atl.core.ATLCoreException;
import org.eclipse.m2m.atl.core.IExtractor;
import org.eclipse.m2m.atl.core.IInjector;
import org.eclipse.m2m.atl.core.IModel;
import org.eclipse.m2m.atl.core.IReferenceModel;
import org.eclipse.m2m.atl.core.ModelFactory;
import org.eclipse.m2m.atl.core.emf.EMFExtractor;
import org.eclipse.m2m.atl.core.emf.EMFInjector;
import org.eclipse.m2m.atl.core.emf.EMFModelFactory;
import org.eclipse.m2m.atl.core.launch.ILauncher;
import org.eclipse.m2m.atl.engine.emfvm.launch.EMFVMLauncher;

/**
 * Entry point of the 'UMLToClassDiagramMAVO_M2M' transformation module.
 */
public class UMLToClassDiagramMAVO_M2M {

	/**
	 * The property file. Stores module list, the metamodel and library locations.
	 * @generated
	 */
	private Properties properties;
	
	/**
	 * The IN model.
	 * @generated
	 */
	protected IModel inModel;	
	
	/**
	 * The OUT model.
	 * @generated
	 */
	protected IModel outModel;	
		
	/**
	 * The main method.
	 * 
	 * @param args
	 *            are the arguments
	 * @generated
	 */
	public static void main(String[] args) {
		try {
<span class="nc bnc" id="L74" title="All 2 branches missed.">			if (args.length &lt; 2) {</span>
<span class="nc" id="L75">				System.out.println(&quot;Arguments not valid : {IN_model_path, OUT_model_path}.&quot;);</span>
<span class="nc" id="L76">			} else {</span>
<span class="nc" id="L77">				UMLToClassDiagramMAVO_M2M runner = new UMLToClassDiagramMAVO_M2M();</span>
<span class="nc" id="L78">				runner.loadModels(args[0]);</span>
<span class="nc" id="L79">				runner.doUMLToClassDiagramMAVO_M2M(new NullProgressMonitor());</span>
<span class="nc" id="L80">				runner.saveModels(args[1]);</span>
			}
<span class="nc" id="L82">		} catch (ATLCoreException e) {</span>
<span class="nc" id="L83">			e.printStackTrace();</span>
<span class="nc" id="L84">		} catch (IOException e) {</span>
<span class="nc" id="L85">			e.printStackTrace();</span>
<span class="nc" id="L86">		} catch (ATLExecutionException e) {</span>
<span class="nc" id="L87">			e.printStackTrace();</span>
		}
<span class="nc" id="L89">	}</span>

	/**
	 * Constructor.
	 *
	 * @generated
	 */
<span class="nc" id="L96">	public UMLToClassDiagramMAVO_M2M() throws IOException {</span>
<span class="nc" id="L97">		properties = new Properties();</span>
<span class="nc" id="L98">		properties.load(getFileURL(&quot;UMLToClassDiagramMAVO_M2M.properties&quot;).openStream());</span>
<span class="nc" id="L99">		EPackage.Registry.INSTANCE.put(getMetamodelUri(&quot;UML&quot;), org.eclipse.uml2.uml.UMLPackage.eINSTANCE);</span>
<span class="nc" id="L100">		Resource.Factory.Registry.INSTANCE.getExtensionToFactoryMap().put(&quot;ecore&quot;, new EcoreResourceFactoryImpl());</span>
<span class="nc" id="L101">	}</span>
	
	/**
	 * Load the input and input/output models, initialize output models.
	 * 
	 * @param inModelPath
	 *            the IN model path
	 * @throws ATLCoreException
	 *             if a problem occurs while loading models
	 *
	 * @generated
	 */
	public void loadModels(String inModelPath) throws ATLCoreException {
<span class="nc" id="L114">		ModelFactory factory = new EMFModelFactory();</span>
<span class="nc" id="L115">		IInjector injector = new EMFInjector();</span>
<span class="nc" id="L116">	 	IReferenceModel umlMetamodel = factory.newReferenceModel();</span>
<span class="nc" id="L117">		injector.inject(umlMetamodel, getMetamodelUri(&quot;UML&quot;));</span>
<span class="nc" id="L118">	 	IReferenceModel classdiagram_mavoMetamodel = factory.newReferenceModel();</span>
<span class="nc" id="L119">		injector.inject(classdiagram_mavoMetamodel, getMetamodelUri(&quot;ClassDiagram_MAVO&quot;));</span>
<span class="nc" id="L120">		this.inModel = factory.newModel(umlMetamodel);</span>
<span class="nc" id="L121">		injector.inject(inModel, inModelPath);</span>
<span class="nc" id="L122">		this.outModel = factory.newModel(classdiagram_mavoMetamodel);</span>
<span class="nc" id="L123">	}</span>
	
	/**
	 * Save the output and input/output models.
	 * 
	 * @param outModelPath
	 *            the OUT model path
	 * @throws ATLCoreException
	 *             if a problem occurs while saving models
	 *
	 * @generated
	 */
	public void saveModels(String outModelPath) throws ATLCoreException {
<span class="nc" id="L136">		IExtractor extractor = new EMFExtractor();</span>
<span class="nc" id="L137">		extractor.extract(outModel, outModelPath);</span>
<span class="nc" id="L138">	}</span>

	/**
	 * Transform the models.
	 * 
	 * @param monitor
	 *            the progress monitor
	 * @throws ATLCoreException
	 *             if an error occurs during models handling
	 * @throws IOException
	 *             if a module cannot be read
	 * @throws ATLExecutionException
	 *             if an error occurs during the execution
	 *
	 * @generated
	 */
	public Object doUMLToClassDiagramMAVO_M2M(IProgressMonitor monitor) throws ATLCoreException, IOException, ATLExecutionException {
<span class="nc" id="L155">		ILauncher launcher = new EMFVMLauncher();</span>
<span class="nc" id="L156">		Map&lt;String, Object&gt; launcherOptions = getOptions();</span>
<span class="nc" id="L157">		launcher.initialize(launcherOptions);</span>
<span class="nc" id="L158">		launcher.addInModel(inModel, &quot;IN&quot;, &quot;UML&quot;);</span>
<span class="nc" id="L159">		launcher.addOutModel(outModel, &quot;OUT&quot;, &quot;ClassDiagram_MAVO&quot;);</span>
<span class="nc" id="L160">		return launcher.launch(&quot;run&quot;, monitor, launcherOptions, (Object[]) getModulesList());</span>
	}

	/**
	 * Returns an Array of the module input streams, parameterized by the
	 * property file.
	 * 
	 * @return an Array of the module input streams
	 * @throws IOException
	 *             if a module cannot be read
	 *
	 * @generated
	 */
	protected InputStream[] getModulesList() throws IOException {
<span class="nc" id="L174">		InputStream[] modules = null;</span>
<span class="nc" id="L175">		String modulesList = properties.getProperty(&quot;UMLToClassDiagramMAVO_M2M.modules&quot;);</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">		if (modulesList != null) {</span>
<span class="nc" id="L177">			String[] moduleNames = modulesList.split(&quot;,&quot;);</span>
<span class="nc" id="L178">			modules = new InputStream[moduleNames.length];</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">			for (int i = 0; i &lt; moduleNames.length; i++) {</span>
<span class="nc" id="L180">				String asmModulePath = new Path(moduleNames[i].trim()).removeFileExtension().addFileExtension(&quot;asm&quot;).toString();</span>
<span class="nc" id="L181">				modules[i] = getFileURL(asmModulePath).openStream();</span>
			}
		}
<span class="nc" id="L184">		return modules;</span>
	}
	
	/**
	 * Returns the URI of the given metamodel, parameterized from the property file.
	 * 
	 * @param metamodelName
	 *            the metamodel name
	 * @return the metamodel URI
	 *
	 * @generated
	 */
	protected String getMetamodelUri(String metamodelName) {
<span class="nc" id="L197">		return properties.getProperty(&quot;UMLToClassDiagramMAVO_M2M.metamodels.&quot; + metamodelName);</span>
	}
	
	/**
	 * Returns the file name of the given library, parameterized from the property file.
	 * 
	 * @param libraryName
	 *            the library name
	 * @return the library file name
	 *
	 * @generated
	 */
	protected InputStream getLibraryAsStream(String libraryName) throws IOException {
<span class="nc" id="L210">		return getFileURL(properties.getProperty(&quot;UMLToClassDiagramMAVO_M2M.libraries.&quot; + libraryName)).openStream();</span>
	}
	
	/**
	 * Returns the options map, parameterized from the property file.
	 * 
	 * @return the options map
	 *
	 * @generated
	 */
	protected Map&lt;String, Object&gt; getOptions() {
<span class="nc" id="L221">		Map&lt;String, Object&gt; options = new HashMap&lt;String, Object&gt;();</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">		for (Entry&lt;Object, Object&gt; entry : properties.entrySet()) {</span>
<span class="nc bnc" id="L223" title="All 2 branches missed.">			if (entry.getKey().toString().startsWith(&quot;UMLToClassDiagramMAVO_M2M.options.&quot;)) {</span>
<span class="nc" id="L224">				options.put(entry.getKey().toString().replaceFirst(&quot;UMLToClassDiagramMAVO_M2M.options.&quot;, &quot;&quot;), </span>
<span class="nc" id="L225">				entry.getValue().toString());</span>
			}
		}
<span class="nc" id="L228">		return options;</span>
	}
	
	/**
	 * Finds the file in the plug-in. Returns the file URL.
	 * 
	 * @param fileName
	 *            the file name
	 * @return the file URL
	 * @throws IOException
	 *             if the file doesn't exist
	 * 
	 * @generated
	 */
	protected static URL getFileURL(String fileName) throws IOException {
		final URL fileURL;
<span class="nc bnc" id="L244" title="All 2 branches missed.">		if (isEclipseRunning()) {</span>
<span class="nc" id="L245">			URL resourceURL = UMLToClassDiagramMAVO_M2M.class.getResource(fileName);</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">			if (resourceURL != null) {</span>
<span class="nc" id="L247">				fileURL = FileLocator.toFileURL(resourceURL);</span>
<span class="nc" id="L248">			} else {</span>
<span class="nc" id="L249">				fileURL = null;</span>
			}
<span class="nc" id="L251">		} else {</span>
<span class="nc" id="L252">			fileURL = UMLToClassDiagramMAVO_M2M.class.getResource(fileName);</span>
		}
<span class="nc bnc" id="L254" title="All 2 branches missed.">		if (fileURL == null) {</span>
<span class="nc" id="L255">			throw new IOException(&quot;'&quot; + fileName + &quot;' not found&quot;);</span>
		} else {
<span class="nc" id="L257">			return fileURL;</span>
		}
	}

	/**
	 * Tests if eclipse is running.
	 * 
	 * @return &lt;code&gt;true&lt;/code&gt; if eclipse is running
	 *
	 * @generated
	 */
	public static boolean isEclipseRunning() {
		try {
<span class="nc" id="L270">			return Platform.isRunning();</span>
<span class="nc" id="L271">		} catch (Throwable exception) {</span>
			// Assume that we aren't running.
		}
<span class="nc" id="L274">		return false;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span>Eclipse Application (8-Jan-2018 6:43:10 PM)</div></body></html>